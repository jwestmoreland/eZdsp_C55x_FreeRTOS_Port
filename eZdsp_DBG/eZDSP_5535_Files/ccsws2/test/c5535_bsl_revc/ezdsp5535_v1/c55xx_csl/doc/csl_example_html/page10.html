<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>C55XX CSL EXAMPLE: MMCSD EXAMPLE DOCUMENTATION</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">C55XX CSL EXAMPLE</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">MMCSD EXAMPLE DOCUMENTATION </div>  </div>
</div>
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="MMC1"></a>
MMCSD EXAMPLE1 - MMC CARD POLL MODE TEST</h2>
<h3><a class="anchor" id="MMC1x"></a>
TEST DESCRIPTION:</h3>
<p>This test code verifies the functionality of the CSL MMCSD module with MultiMediaCard(MMC). This Functionality test includes detecting, initializing, configuring, writing, reading the MMC card using CSL MMCSD module. All these steps are carried out in sequence by different CSL APIs. After the card detection phase test code verifies whether the detected card is MMC or not. Test code stops execution and returns with error incase of card is not MMC. After the successful detection of the MMC, it is initialized and configured. Two data buffers 'gMmcWriteBuff' and 'gMmcReadBuff' are used for MMC write and read operations respectively. MMC write buffer is initialized to values 0 to 255 and is written to MMC sector zero using MMC_write API. Same MMC sector is read using MMC_read API and the data read is stored in the MMC read buffer. Data in the buffers 'gMmcWriteBuff' and 'gMmcReadBuff' is compared to check if MMC read and write operations are successful or not. This test code uses POLLED mode to read and write the MMC data. Functions 'isr_rcv' and 'isr_txmt' are provided to verify MMC_setCallBack API.</p>
<p>Maximum value of the clock at which memory data transaction takes place can be controlled using the macro 'CSL_MMC_CLOCK_MAX_KHZ'. Depending on the clock at which CPU is running, memory clock will be configured to the possible value that is nearest to the value defined by this macro. memory clock will be configured to a value less than or equal to but not greater than the value defined by this macro. Changing this macro value will automatically change the MMC clock divider value. memory clock will be generated from the system clock based on equation</p>
<div class="fragment"><pre class="fragment">
   memory clock = (system clock) / (2 * (CLKRT + 1)
      - memory clock is clock for the memory card
      - system clock is clock at which CPU us running
      - CLKRT is value of clock rate configured in clock control register
   </pre></div><p>As per this equation mmc clock that can be generated is always less than or equal to half of the system clock value. Value of 'CLKRT' can range from 0 to 255. Maximum and minimum mmc clock values that can be generated at a particular frequency are limited by the minimum and maximum value of the memory clock rate (CLKRT).</p>
<p>NOTE: THIS TEST IS INTENDED TO BE USED WITH MMC CARD. IT FAILS WITH SD CARD</p>
<p>NOTE: THIS TEST HAS BEEN DEVELOPED TO WORK WITH CHIP VERSIONS C5505 AND C5515. MAKE SURE THAT PROPER CHIP VERSION MACRO IS DEFINED IN THE FILE c55xx_csl\inc\csl_general.h.</p>
<h3><a class="anchor" id="MMC1y"></a>
TEST PROCEDURE:</h3>
<ul>
<li>Insert "MMC" card into the MMC/SD socket(J9) on the C5505/C5515 EVM </li>
<li>Open the CCS and connect the target (C5505/C5515 EVM) </li>
<li>Open the project "CSL_MMCSD_MmcCardExample_Out.pjt" and build it </li>
<li>Load the program on to the target </li>
<li>Set the PLL frequency to 12.288MHz </li>
<li>Run the program and observe the test result </li>
<li>Repeat the test at PLL frequencies 40, 60, 75 and 100MHz </li>
<li>Repeat the test in Release mode</li>
</ul>
<h3><a class="anchor" id="MMC1z"></a>
TEST RESULT:</h3>
<ul>
<li>All the CSL APIs should return success </li>
<li>Data in the read and write buffers should match</li>
</ul>
<p>============================================================================</p>
<h2><a class="anchor" id="MMC2"></a>
MMCSD EXAMPLE2 - SD CARD POLL MODE TEST</h2>
<h3><a class="anchor" id="MMC2x"></a>
TEST DESCRIPTION:</h3>
<p>This test code verifies the functionality of the CSL MMCSD module with Secure Digital(SD) card. This Functionality test includes detecting, initializing, configuring, writing, reading the SD card using CSL MMCSD module. All these steps are carried out in sequence by different CSL APIs. After the card detection phase test code verifies whether the detected card is SD or not. Test code stops execution and returns with error incase of card is not SD. After the successful detection of the SD card, it is initialized and configured. Two data buffers 'gSdWriteBuff' and 'gSdReadBuff' are used for SD card write and read operations respectively. SD card write buffer is initialized to values 0 to 255 and is written to SD card sector zero using MMC_write API. Same SD card sector is read using MMC_read API and the data read is stored in the SD card read buffer. Data in the buffers 'gSdWriteBuff' and 'gSdReadBuff' is compared to check whether SD card read and write operations are successful or not. This test code uses POLLED mode to read and write the SD card data.</p>
<p>Maximum value of the clock at which memory data transaction takes place can be controlled using the macro 'CSL_SD_CLOCK_MAX_KHZ'. Depending on the clock at which CPU is running, SD clock will be configured to the possible value that is nearest to the value defined by this macro. SD clock will be configured to a value less than or equal to but not greater than the value defined by this macro. Changing this macro value will automatically change the memory clock divider value. memory clock will be generated from the system clock based on equation</p>
<div class="fragment"><pre class="fragment">
   memory clock = (system clock) / (2 * (CLKRT + 1)
      - memory clock is clock for the memory card
      - system clock is clock at which CPU us running
      - CLKRT is value of clock rate configured in clock control register
   </pre></div><p>As per this equation memory clock that can be generated is always less than or equal to half of the system clock value. Value of 'CLKRT' can range from 0 to 255. Maximum and minimum memory clock values that can be generated at a particular CPU frequency are limited by the minimum and maximum value of the memory clock rate (CLKRT).</p>
<p>NOTE: THIS TEST IS INTENDED TO BE USED WITH SD CARD. IT FAILS WITH MMC.</p>
<p>NOTE: THIS TEST HAS BEEN DEVELOPED TO WORK WITH CHIP VERSIONS C5505 AND C5515. MAKE SURE THAT PROPER CHIP VERSION MACRO IS DEFINED IN THE FILE c55xx_csl\inc\csl_general.h.</p>
<h3><a class="anchor" id="MMC2y"></a>
TEST PROCEDURE:</h3>
<ul>
<li>Insert "SD" card into the MMC/SD socket(J9) on the C5505/C5515 EVM </li>
<li>Open the CCS and connect the target (C5505/C5515 EVM) </li>
<li>Open the project "CSL_MMCSD_MmcCardExample_Out.pjt" and build it </li>
<li>Load the program on to the target </li>
<li>Set the PLL frequency to 12.288MHz </li>
<li>Run the program and observe the test result </li>
<li>Repeat the test at PLL frequencies 40, 60, 75 and 100MHz </li>
<li>Repeat the test in Release mode</li>
</ul>
<h3><a class="anchor" id="MMC2z"></a>
TEST RESULT:</h3>
<ul>
<li>All the CSL APIs should return success </li>
<li>Data in the read and write buffers should match</li>
</ul>
<p>============================================================================</p>
<h2><a class="anchor" id="MMC3"></a>
MMCSD EXAMPLE3 - MMC/SD CARD DMA MODE TEST</h2>
<h3><a class="anchor" id="MMC3x"></a>
TEST DESCRIPTION:</h3>
<p>This test code verifies the functionality of CSL MMCSD module in DMA mode. This Functionality test includes detecting, initializing, configuring, writing, reading the SD/MMC card using CSL MMCSD module.</p>
<p>This test includes two parts. In the first part MMCSD write and read are performed without using the callback function. MMCSD module should be initialized and opened in DMA mode. Two DMA channels are opened for MMCSD data transfers using DMA_open API. These channels should be assigned to MMCSD internal data structures using MMC_setDmaHandle() API. MMC read and write APIs will use these handles to configure the DMA module and start the DMA data transfers. After successful detection of the card MMC module will be configured and MMC_write() API is called to write the data to the card inserted. Write API returns after successful completion of the data write using DMA module. MMC_read() API is called to read the data from the card. Read API returns after successful completion of the read operation using DMA module. Write and read buffers are compared for data verification.</p>
<p>In the second part of the test read and write are performed in the same way as in the first part of the test except that data call back function is configured using MMC_setDataTransferCallback() API. This call back function is called from the MMC write and read APIs after staring the DMA transfer. Completion of the data transfer should be checked in the call back function. Data transfer completion is verified using MMCSD interrupts. MMCSD interrupts should be configured and ISR should be registered using CSL INTC module.</p>
<p>Maximum value of the clock at which memory data transaction takes place can be controlled using the macros 'CSL_SD_CLOCK_MAX_KHZ' and 'CSL_MMC_CLOCK_MAX_KHZ' for SD and MMC cards respectively. Depending on the clock at which CPU is running, memory clock will be configured to the possible value that is nearest to the value defined by these macros. memory clock will be configured to a value less than or equal to but not greater than the value defined by these macros. Changing these macro values will automatically change the memory clock divider value. memory clock will be generated from the system clock based on equation</p>
<div class="fragment"><pre class="fragment">
   memory clock = (system clock) / (2 * (CLKRT + 1)
      - memory clock is clock for the memory card
      - system clock is clock at which CPU us running
      - CLKRT is value of clock rate configured in clock control register
   </pre></div><p>As per this equation memory clock that can be generated is always less than or equal to half of the system clock value. Value of 'CLKRT' can range from 0 to 255. Maximum and minimum memory clock values that can be generated at a particular CPU frequency are limited by the minimum and maximum value of the memory clock rate (CLKRT).</p>
<p>NOTE: THIS TEST WORKS WITH SD AND MMC CARD.</p>
<p>NOTE: THIS TEST HAS BEEN DEVELOPED TO WORK WITH CHIP VERSIONS C5505 AND C5515. MAKE SURE THAT PROPER CHIP VERSION MACRO IS DEFINED IN THE FILE c55xx_csl\inc\csl_general.h.</p>
<h3><a class="anchor" id="MMC3y"></a>
TEST PROCEDURE:</h3>
<ul>
<li>Insert "MMC/SD" card into the MMC/SD socket(J9) on the C5505/C5515 EVM </li>
<li>Open the CCS and connect the target (C5505/C5515 EVM) </li>
<li>Open the project "CSL_MMCSD_dmaExample_Out.pjt" and build it </li>
<li>Load the program on to the target </li>
<li>Set the PLL frequency to 12.288MHz </li>
<li>Run the program and observe the test result </li>
<li>Repeat the test at PLL frequencies 40, 60, 75 and 100MHz </li>
<li>Repeat the test in Release mode</li>
</ul>
<h3><a class="anchor" id="MMC3z"></a>
TEST RESULT:</h3>
<ul>
<li>All the CSL APIs should return success </li>
<li>Data in the read and write buffers should match in both parts of the test</li>
</ul>
<p>============================================================================</p>
<h2><a class="anchor" id="MMC4"></a>
MMCSD EXAMPLE4 - MMCSD-ATFS INTERFACE TEST</h2>
<h3><a class="anchor" id="MMC4x"></a>
TEST DESCRIPTION:</h3>
<p>This test code verifies the functionality of MMCSD-ATAFS interface. ATA File System is used to create, write and read files on the SD card. Files created by the ATFS can be read from windows PC using a card reader.</p>
<p>During the test a file is created on the SD card, 512 bytes of data is written to the file and the same data is read back. CSL MMCSD module should be configured before initializing the file system. During the card detection test code checks for the SD card.If no SD card is detected test exits with error. After successful detection and configuration of the SD card file system should be initialized using ATA_systemInit(). SD card should be formatted to run this test. ATA_systemInit() function fails if the card is not formatted. File with the given name is created using ATA_create() API. 512 bytes of data is written to the file created using ATA_write() API. After successful completion of write operation same data is read from the card using ATA_readLittleEndian(). Write and read buffers are compared for the data verification. The file created and data written can be accessed using a SD card reader. This test is executed in both polling and DMA modes.</p>
<p>Maximum value of the clock at which memory data transaction takes place can be controlled using the macro 'CSL_SD_CLOCK_MAX_KHZ'. Depending on the clock at which CPU is running, SD clock will be configured to the possible value that is nearest to the value defined by this macro. SD clock will be configured to a value less than or equal to but not greater than the value defined by this macro. Changing this macro value will automatically change the memory clock divider value. memory clock will be generated from the system clock based on equation</p>
<div class="fragment"><pre class="fragment">
   memory clock = (system clock) / (2 * (CLKRT + 1)
      - memory clock is clock for the memory card
      - system clock is clock at which CPU us running
      - CLKRT is value of clock rate configured in clock control register
   </pre></div><p>As per this equation memory clock that can be generated is always less than or equal to half of the system clock value. Value of 'CLKRT' can range from 0 to 255. Maximum and minimum memory clock values that can be generated at a particular CPU frequency are limited by the minimum and maximum value of the memory clock rate (CLKRT).</p>
<p>NOTE: THIS TEST WORKS WITH ONLY SD CARD. SD CARD SHOULD BE FORMATTED TO RUN THIS TEST.</p>
<p>NOTE: THIS TEST HAS BEEN DEVELOPED TO WORK WITH CHIP VERSIONS C5505 AND C5515. MAKE SURE THAT PROPER CHIP VERSION MACRO IS DEFINED IN THE FILE c55xx_csl\inc\csl_general.h.</p>
<h3><a class="anchor" id="MMC4y"></a>
TEST PROCEDURE:</h3>
<ul>
<li>Insert formatted "SD" card into the MMC/SD socket(J9) on the C5505/C5515 EVM </li>
<li>Open the CCS and connect the target (C5505/C5515 EVM) </li>
<li>Open the project "CSL_MMCSD_SdCardFSExample_Out.pjt" and build it </li>
<li>Load the program on to the target </li>
<li>Set the PLL frequency to 12.288MHz </li>
<li>Run the program and observe the test result </li>
<li>Repeat the test at PLL frequencies 40, 60, 75 and 100MHz </li>
<li>Repeat the test in Release mode</li>
</ul>
<h3><a class="anchor" id="MMC4z"></a>
TEST RESULT:</h3>
<ul>
<li>All the CSL APIs should return success </li>
<li>Data in the read and write buffers should match. </li>
<li>File created should be accessible from a windows PC using card reader.</li>
</ul>
<p>============================================================================</p>
<h2><a class="anchor" id="MMC5"></a>
MMCSD EXAMPLE5 - MMC/SD CARD INTERRUPT MODE TEST</h2>
<h3><a class="anchor" id="MMC3x"></a>
TEST DESCRIPTION:</h3>
<p>This test code verifies the functionality of CSL MMCSD module in interrupt mode. This Functionality test includes detecting, initializing, configuring, writing, reading the SD/MMC card using CSL MMCSD module.</p>
<p>During the test MMCSD module will be initialized and opened in interrupt mode. MMCSD data transfer call back function is configured using MMC_setDataTransferCallback() API. This callback function is called from MMC read and write APIs. When this callback function is invoked, execution waits until MMCSD generates an interrupt. After receiving the interrupt call back function disables all the MMCSD interrupts and returns the value of MMC status register(MMCST0). Interrupts enabled during a particular callback will be decided by the CSL APIs. After successful detection of the card MMC module will be configured and MMC_write() API is called to write the data to the card inserted. Write API returns after successful completion of the data write. MMC_read() API is called to read the data from the card. Read API returns after successful completion of the read operation. Both read and write APIs invoke callback function during the data transfers. Write and read buffers are compared for data verification.</p>
<p>Maximum value of the clock at which memory data transaction takes place can be controlled using the macros 'CSL_SD_CLOCK_MAX_KHZ' and 'CSL_MMC_CLOCK_MAX_KHZ' for SD and MMC cards respectively. Depending on the clock at which CPU is running, memory clock will be configured to the possible value that is nearest to the value defined by these macros. memory clock will be configured to a value less than or equal to but not greater than the value defined by these macros. Changing these macro values will automatically change the memory clock divider value. memory clock will be generated from the system clock based on equation</p>
<div class="fragment"><pre class="fragment">
   memory clock = (system clock) / (2 * (CLKRT + 1)
      - memory clock is clock for the memory card
      - system clock is clock at which CPU us running
      - CLKRT is value of clock rate configured in clock control register
   </pre></div><p>As per this equation memory clock that can be generated is always less than or equal to half of the system clock value. Value of 'CLKRT' can range from 0 to 255. Maximum and minimum memory clock values that can be generated at a particular CPU frequency are limited by the minimum and maximum value of the memory clock rate (CLKRT).</p>
<p>NOTE: THIS TEST WORKS WITH SD AND MMC CARD.</p>
<p>NOTE: THIS TEST HAS BEEN DEVELOPED TO WORK WITH CHIP VERSIONS C5505 AND C5515. MAKE SURE THAT PROPER CHIP VERSION MACRO IS DEFINED IN THE FILE c55xx_csl\inc\csl_general.h.</p>
<h3><a class="anchor" id="MMC3y"></a>
TEST PROCEDURE:</h3>
<ul>
<li>Insert "MMC/SD" card into the MMC/SD socket(J9) on the C5505/C5515 EVM </li>
<li>Open the CCS and connect the target (C5505/C5515 EVM) </li>
<li>Open the project "CSL_MMCSD_dmaExample_Out.pjt" and build it </li>
<li>Load the program on to the target </li>
<li>Set the PLL frequency to 12.288MHz </li>
<li>Run the program and observe the test result </li>
<li>Repeat the test at PLL frequencies 40, 60, 75 and 100MHz </li>
<li>Repeat the test in Release mode</li>
</ul>
<h3><a class="anchor" id="MMC3z"></a>
TEST RESULT:</h3>
<ul>
<li>All the CSL APIs should return success </li>
<li>Data in the read and write buffers should match </li>
</ul>
</div></div>
<hr class="footer"/><address class="footer"><small>Generated on Thu Jun 23 2011 15:26:20 for C55XX CSL EXAMPLE by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
