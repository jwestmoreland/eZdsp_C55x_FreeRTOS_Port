<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>C55XX CSL Version 2.50: csl_mmcsd_ataIf.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="$relpath/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="$relpath/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<table width="100%">
<tr>
  <td bgcolor="black" width="1"><a href="http://www.ti.com"><img border="0" src="tilogo.gif" /></a></td>
  <td bgcolor="red"><img src="titagline.gif" /></td>
</tr>
</table>
<!-- Generated by Doxygen 1.7.4 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">csl_mmcsd_ataIf.c File Reference</div>  </div>
</div>
<div class="contents">

<p>Functional layer API source file for MMCSD ATA file system interface.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="csl__mmcsd_8h_source.html">csl_mmcsd.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="csl__mmcsd__ataIf_8h_source.html">csl_mmcsd_ataIf.h</a>&quot;</code><br/>
</div><table class="memberdecls">
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ade38862d42eb7a8a274d8031490a559e"></a><!-- doxytag: member="csl_mmcsd_ataIf.c::ENABLE_CACHE" ref="ade38862d42eb7a8a274d8031490a559e" args="" -->
#define&#160;</td><td class="memItemRight" valign="bottom"><b>ENABLE_CACHE</b>&#160;&#160;&#160;1</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">AtaError&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CSL__MMCSD__FUNCTION.html#ga4a124fb564fdc4f89e38cd751dbac170">MMC_initState</a> (<a class="el" href="structAtaStateStruct.html">AtaState</a> *pDrive)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">AtaError&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="csl__mmcsd__ataIf_8c.html#a33db19f4e4d265e2f76bb99309534c85">MMC_readWriteControl</a> (AtaSector phySector, void *pAtaMediaState, AtaUint16 *pWord, int last_sector)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">AtaError&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CSL__MMCSD__FUNCTION.html#ga82778fe9313e874740bcd78a3f070cf8">MMC_issueReadCommand</a> (AtaSector phySector, void *pAtaMediaState, AtaUint16 sectorCount)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">AtaError&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CSL__MMCSD__FUNCTION.html#gac33a4b6e29921e909ba63fbf23aaca6e">MMC_readNextWord</a> (void *pAtaMediaState, AtaUint16 *pWord)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">AtaError&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CSL__MMCSD__FUNCTION.html#ga8ccf47efae5b6671edfb4e50715e128b">MMC_readNextWord1</a> (void *pAtaMediaState, AtaUint16 *pWord, AtaUint16 word_delta)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">AtaError&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CSL__MMCSD__FUNCTION.html#ga42474102f50665ea6e3e0b909e0b6957">MMC_readNextNWords</a> (void *pAtaMediaState, AtaUint16 *pData, AtaUint16 words)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">AtaError&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CSL__MMCSD__FUNCTION.html#gad904a36b62dff38809b18706f2b217a8">MMC_writeSector</a> (AtaSector phySector, void *pAtaMediaState, AtaUint16 *pWord, int byteSwap)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">AtaError&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CSL__MMCSD__FUNCTION.html#ga52ba79b3047d32681fd2f3e507df2792">MMC_readNSectors</a> (void *pAtaMediaState, AtaUint16 *pReadBuf, AtaSector startSector, AtaUint16 sectorCount)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">AtaError&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CSL__MMCSD__FUNCTION.html#ga1ce2cec113d65fdb5a88bdd6f462e330">MMC_writeNSectors</a> (void *pAtaMediaState, AtaUint16 *pWriteBuf, AtaSector startSector, AtaUint16 sectorCount)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">AtaError&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CSL__MMCSD__FUNCTION.html#ga3b287854bf37514bd37abbfc5eb6d278">MMC_read_CID</a> (void *pAtaMediaState, unsigned int *pBuf)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">AtaError&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CSL__MMCSD__FUNCTION.html#gad815e54ad246ae449a41e7b4c7e7665b">MMC_read_CSD</a> (void *pAtaMediaState, unsigned int *pBuf)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">AtaError&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CSL__MMCSD__FUNCTION.html#ga387ce86f026b4c9a65f057bd0d4bf0dc">MMC_writeSectorFlush</a> (void *pAtaMediaState)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CSL__MMCSD__FUNCTION.html#ga002536f323acd8cdcecad9173bb2663a">MMC_commandReadyStatusCheck</a> (void *pAtaMediaState)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">AtaError&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CSL__MMCSD__FUNCTION.html#gad12d09d9b9660efa91fe5c7f7ed1352c">MMC_dataReadyStatusCheck</a> (void *pAtaMediaState)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">AtaError&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CSL__MMCSD__FUNCTION.html#gaf98518d61cbf3f71d490016ca130f890">MMC_busyStatusCheck</a> (void *pAtaMediaState)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">AtaUint16&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CSL__MMCSD__FUNCTION.html#gaf582af3048a97a1354accc831339d7a2">MMC_getSerialID</a> (void *pAtaMediaState, AtaSerialID *pSerID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">AtaUint16&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CSL__MMCSD__FUNCTION.html#ga26f99b002a33a81075edf1fd77ee6aa4">MMC_file_system_format</a> (void *pAtaMediaState)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">AtaError&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CSL__MMCSD__FUNCTION.html#gafd44c2a140fd9eb1c97e623515b256aa">MMC_reset</a> (void *pAtaMediaState)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">AtaUint16&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CSL__MMCSD__FUNCTION.html#ga2c89af9f936bf0bd0ca53585406e4a7b">MMC_get_time</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">AtaUint16&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CSL__MMCSD__FUNCTION.html#gae05d86cbca3a1aaacc03fda968bfc15d">MMC_get_mod_time</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">AtaUint16&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CSL__MMCSD__FUNCTION.html#ga925e89ab4b717172b1a2ef7dbdf40b2b">MMC_get_date</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">AtaUint16&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CSL__MMCSD__FUNCTION.html#gab0a34021ba2878cb90c65d894a6c9d5c">MMC_get_mod_date</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">AtaError&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CSL__MMCSD__FUNCTION.html#ga1a0cb92aff7fccadf76863408e31fd91">MMC_flushFat</a> (void *pAtaMediaState)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static AtaError&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="csl__mmcsd__ataIf_8c.html#ab8503707f26c8dd958ca6738106032f4">getAtaErrorNo</a> (CSL_Status result)</td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a80b3ecc4efa5ec33f1d6695b3440188a"></a><!-- doxytag: member="csl_mmcsd_ataIf.c::gReadBuf" ref="a80b3ecc4efa5ec33f1d6695b3440188a" args="[CSL_MMCSD_PAGE_SIZE/2]" -->
Uint16&#160;</td><td class="memItemRight" valign="bottom"><b>gReadBuf</b> [CSL_MMCSD_PAGE_SIZE/2] = {0xbb,}</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="afe0acb4f47707640eee3151301f3cfb0"></a><!-- doxytag: member="csl_mmcsd_ataIf.c::gWordCount" ref="afe0acb4f47707640eee3151301f3cfb0" args="" -->
Uint16&#160;</td><td class="memItemRight" valign="bottom"><b>gWordCount</b> = 256</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae25b5cf2b40df77bbf4d95b8d180ad7b"></a><!-- doxytag: member="csl_mmcsd_ataIf.c::gNextPhySector" ref="ae25b5cf2b40df77bbf4d95b8d180ad7b" args="" -->
AtaSector&#160;</td><td class="memItemRight" valign="bottom"><b>gNextPhySector</b> = 0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a10b79d80fa7934239e51e1499b66a494"></a><!-- doxytag: member="csl_mmcsd_ataIf.c::gWriteBuf" ref="a10b79d80fa7934239e51e1499b66a494" args="[2 *CSL_MMCSD_PAGE_SIZE]" -->
Uint16&#160;</td><td class="memItemRight" valign="bottom"><b>gWriteBuf</b> [2 *CSL_MMCSD_PAGE_SIZE]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a943f3ed08923d5970085c426230c7f67"></a><!-- doxytag: member="csl_mmcsd_ataIf.c::cached_phySector0" ref="a943f3ed08923d5970085c426230c7f67" args="" -->
AtaSector&#160;</td><td class="memItemRight" valign="bottom"><b>cached_phySector0</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a407bf8ed5049be7e3e78eb349995cc76"></a><!-- doxytag: member="csl_mmcsd_ataIf.c::cached_phySector1" ref="a407bf8ed5049be7e3e78eb349995cc76" args="" -->
AtaSector&#160;</td><td class="memItemRight" valign="bottom"><b>cached_phySector1</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a10066b8d8c01c4dff22b916274eb1a4f"></a><!-- doxytag: member="csl_mmcsd_ataIf.c::cached_phySector2" ref="a10066b8d8c01c4dff22b916274eb1a4f" args="" -->
AtaSector&#160;</td><td class="memItemRight" valign="bottom"><b>cached_phySector2</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a256ed643b366c73796329e1ab4754c81"></a><!-- doxytag: member="csl_mmcsd_ataIf.c::cached_phySector3" ref="a256ed643b366c73796329e1ab4754c81" args="" -->
AtaSector&#160;</td><td class="memItemRight" valign="bottom"><b>cached_phySector3</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ab3934acb589a73d8435941617c23dde5"></a><!-- doxytag: member="csl_mmcsd_ataIf.c::nbuf_cached" ref="ab3934acb589a73d8435941617c23dde5" args="" -->
AtaUint16&#160;</td><td class="memItemRight" valign="bottom"><b>nbuf_cached</b> = 0</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Functional layer API source file for MMCSD ATA file system interface. </p>
<p>Path: \(CSLPATH)\ src </p>
</div><hr/><h2>Function Documentation</h2>
<a class="anchor" id="ab8503707f26c8dd958ca6738106032f4"></a><!-- doxytag: member="csl_mmcsd_ataIf.c::getAtaErrorNo" ref="ab8503707f26c8dd958ca6738106032f4" args="(CSL_Status result)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static AtaError getAtaErrorNo </td>
          <td>(</td>
          <td class="paramtype">CSL_Status&#160;</td>
          <td class="paramname"><em>result</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>=========================================================================== <br/>
<b>getAtaErrorNo</b> </p>
<p><b>Description</b> <br/>
 This function checks the return value send by the MMCSD CSL module and returns the corresponding error value to the ATA File system. This function is called in case of any error occurred</p>
<p><b>Arguments</b> </p>
<div class="fragment"><pre class="fragment">
            result    Result returned by the CSL MMCSD module
     </pre></div><p><b> Return Value </b> AtaError </p>
<ul>
<li>ATA_ERROR_INVALID_PARAM - Returned for Invalid input parameters </li>
<li>ATA_ERROR_TIMEOUT - Time out Error Occurred </li>
<li>ATA_ERROR_UNSUPPORTED - MMC/SD hardware is not supported</li>
</ul>
<p><b> Pre Condition </b> <br/>
 None</p>
<p><b> Post Condition </b> <br/>
 Returns ATA Error codes</p>
<p><b>Modifies</b> <br/>
 None</p>
<p><b>Example</b> </p>
<div class="fragment"><pre class="fragment">
            CSL_Status    result;
            AtaError      ataErr;

            result = MMC_init();

            ataErr = getAtaErrorNo(result);

     </pre></div><p> =========================================================================== </p>

<p>Referenced by <a class="el" href="group__CSL__MMCSD__FUNCTION.html#ga82778fe9313e874740bcd78a3f070cf8">MMC_issueReadCommand()</a>, <a class="el" href="group__CSL__MMCSD__FUNCTION.html#ga52ba79b3047d32681fd2f3e507df2792">MMC_readNSectors()</a>, <a class="el" href="group__CSL__MMCSD__FUNCTION.html#ga1ce2cec113d65fdb5a88bdd6f462e330">MMC_writeNSectors()</a>, and <a class="el" href="group__CSL__MMCSD__FUNCTION.html#gad904a36b62dff38809b18706f2b217a8">MMC_writeSector()</a>.</p>

</div>
</div>
<a class="anchor" id="a33db19f4e4d265e2f76bb99309534c85"></a><!-- doxytag: member="csl_mmcsd_ataIf.c::MMC_readWriteControl" ref="a33db19f4e4d265e2f76bb99309534c85" args="(AtaSector phySector, void *pAtaMediaState, AtaUint16 *pWord, int last_sector)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">AtaError MMC_readWriteControl </td>
          <td>(</td>
          <td class="paramtype">AtaSector&#160;</td>
          <td class="paramname"><em>phySector</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>pAtaMediaState</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">AtaUint16 *&#160;</td>
          <td class="paramname"><em>pWord</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>last_sector</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>=========================================================================== <br/>
<b>MMC_readWriteControl</b> //KR041110</p>
<p><b>Description</b> <br/>
 This function is used to cache and write data to the media. This function can write 1 to 4 sectors each sector containing 512 bytes</p>
<p><b>Arguments</b> </p>
<div class="fragment"><pre class="fragment">
            phySector         Sector number from which data needs to be read
            pAtaMediaState    ATA media state structure
            pWord             Write data buffer
            last_sector       Flag to flush cache
     </pre></div><p><b> Return Value </b> AtaError </p>
<ul>
<li>ATA_ERROR_NONE - Returned for success </li>
<li>ATA_ERROR_INVALID_PARAM - Returned for Invalid input parameters </li>
<li>ATA_ERROR_TIMEOUT - Time out Error Occurred </li>
<li>ATA_ERROR_UNSUPPORTED - MMC/SD hardware is not supported</li>
</ul>
<p><b> Pre Condition </b> <br/>
 MMC_initState API should be called successfully.</p>
<p><b> Post Condition </b> <br/>
 Writes Data to MMC/SD card</p>
<p><b>Modifies</b> <br/>
 MMCSD Sector data</p>
<p><b>Example</b> </p>
<div class="fragment"><pre class="fragment">
 			#define CSL_MMCSD_BUF_SIZE (256u)

			AtaMMCState    ataMediaState;
			AtaState       ataState;
			AtaState       *pAtaState;
			AtaError       ataErr;
			AtaSector      phySector;
			AtaUint16      writeBuf[CSL_MMCSD_BUF_SIZE];

			pAtaState = &amp;ataState;

			phySector = 0;
			ataState-&gt;pAtaMediaState = &amp;ataMediaState;

			ataErr = MMC_initState(&amp;ataState);

            ataErr = pAtaState-&gt;AtaWriteSector(phySector,
                                               ataState-&gt;pAtaMediaState,
                                               writeBuf, FALSE);

     </pre></div><p> =========================================================================== </p>

<p>References <a class="el" href="group__CSL__MMCSD__SYMBOL.html#ga53c34b168261e46dad52108823188c87">CSL_MMCSD_PAGE_SIZE</a>, <a class="el" href="group__CSL__MMCSD__FUNCTION.html#ga1ce2cec113d65fdb5a88bdd6f462e330">MMC_writeNSectors()</a>, and <a class="el" href="group__CSL__MMCSD__FUNCTION.html#gad904a36b62dff38809b18706f2b217a8">MMC_writeSector()</a>.</p>

<p>Referenced by <a class="el" href="group__CSL__MMCSD__FUNCTION.html#ga4a124fb564fdc4f89e38cd751dbac170">MMC_initState()</a>.</p>

</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Thu Jun 23 2011 15:25:53 for C55XX CSL Version 2.50 by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
